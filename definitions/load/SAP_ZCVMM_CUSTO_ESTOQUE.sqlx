config {
    type: "incremental",
    schema: "RAW",
    tags: ["sap"]
}

SELECT 
    MATNR,
    LGORT,
    LABST,
    VERPR,
    TIMESTAMP_TRUNC(CURRENT_TIMESTAMP(), MINUTE) AS PARTITIONTIME
FROM `LAND.SAP_ZCVMM_CUSTO_ESTOQUE`

${ when(incremental(), `WHERE TIMESTAMP_TRUNC(CURRENT_TIMESTAMP(), MINUTE) > (SELECT MAX(PARTITIONTIME) FROM ${self()})`) }