config {
    type: "incremental",
    schema: "RAW",
    tags: ["sap", "cubo-estoque"]
}

SELECT 
    WERKS,
    MATNR,
    MENGE,
    TIMESTAMP_TRUNC(CURRENT_TIMESTAMP(), MINUTE) AS PARTITIONTIME
FROM `LAND.SAP_ZCVMM_TRANSITO_ESTOQUE`

${ when(incremental(), `WHERE TIMESTAMP_TRUNC(CURRENT_TIMESTAMP(), MINUTE) > (SELECT MAX(PARTITIONTIME) FROM ${self()})`) }